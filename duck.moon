-- title:  Duck
-- author: Nathan Jent
-- desc:   A game about a duck.
-- script: moon

t=0
objs={
 {
  x:96
  y:24
  elapsed:0
  flip:0
  states:{
   -- idle
   { w:2, h:2, frames:{ 272 } },
   -- walking
   {
    w:2
    h:2
    frames:{ 304, 306, 308, 304, 306, 308 }
   },
   -- ducking
   { w:3, h:2, frames:{ 336 } },
   -- quacking
   { w:2, h:2, frames:{ 368 } },
  }
 },
 {
  x:138
  y:48
  states:{
   {frames:{270}}
   {frames:{271}}
  }
 }
}

is_wall = (tile_id) ->
 fget(tile_id,0)

update = (t) ->
 p=objs[1]
 p.state = 1
 p.elapsed += 1
 if p.elapsed > 10
  p.elapsed = 0
  if p.tic and p.tic <= 6
   p.tic += 1
  else
   p.tic = 1
  p.holding = false

 if btn(4)
  p.state = 3
 if btn(5)
  p.state = 4
 if btnp(5)
  sfx(0,"G-4",15)
 if btn(6)
  p.holding = true
 if btn(0)
  p.y -= 1
  p.state = 2
 if btn(1)
  p.y += 1
  p.state = 2
 if btn(2)
  p.x -= 1
  p.state = 2
  p.flip = 1
 elseif btn(3)
  p.x += 1
  p.state = 2
  p.flip = 0

draw_obj=(obj)->
 tic = obj.tic or 1
 sdata = obj.states[obj.state or 1]
 frame = if tic > #sdata.frames
  sdata.frames[tic % #sdata.frames + 1]
 else
  sdata.frames[tic]

 spr(frame,obj.x,obj.y,0,1,obj.flip,0,sdata.w or 1,sdata.h or 1)

 current_tile = mget(obj.x/8,obj.y/8)
 print("current_tile: #{current_tile}",0,0,2)
 if is_wall(current_tile)
  print("hit",0,16,2)

draw=(t)->
 cls(11)
 map(0,0,40,40,0,0)
 for obj in *objs
  draw_obj(obj)

-- music(0,0)

export TIC = ->
 update(t)
 draw(t)
 t += 1

-- <TILES>
-- 012:ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
-- 013:ffffffffffffffffffffffeeffffffffffffeeeffffffffffeefffffffffffff
-- 014:ffffffffffffffffffffffffffeefffffffffeeffffffffffeefffffffffffff
-- 015:fffffffffffffffffeefffffffffffffffffeeffffffffffffeeefffffffffff
-- 029:fffffffffffffeefffffffffffeefffffffffffffffffffffffeeeffffffffff
-- 030:ffffffffffffeefffeeffffffffffeefffeefffffffffffffffeeeffffffffff
-- 031:ffffffffffeefffffffffffffffffffffeeffffffffffffffffeeeffffffffff
-- 045:ffffffffffeefffffffffeeefffffffffffeeeffffffffffffffffffffffffff
-- 046:fffffffffeeffffffffffffffffffeeffffffffffeeeffffffffffffffffffff
-- 047:fffffffffeefffffffffeeefffffffffffeeffffffffffffffffffffffffffff
-- 208:eddddddefeeeeeedfeedddedfefeeeddfefeeedefeefffedfeeeeeedeffffffe
-- 224:eddddddefeeddeedfefeededfefeededfefeededfeeffeedfeeeeeedeffffffe
-- 225:eddddddefeeeeeedfeeddeedfefeededfefeededfeeffeedfeeeeeedeffffffe
-- 226:eddddddefeddeeedffeedeedffeeededffeeededfefffeedfeeeeeedeffffffe
-- 239:bbaaaaabaaaabbbaabbbaaaabaaaaabbaaabbbaaabbaaaaabaaaaabbaabbbbaa
-- 240:eddddddefeeeeeedfedddeedffeeededffeeededffeedeedfeffeeedeffffffe
-- 241:eddddddefeeeeeedfedddeedffeeededffeeededfefffeedfeeeeeedeffffffe
-- 242:eddddddefeeddeedfefeededfefeeeddfefeeedefeefffedfeeeeeedeffffffe
-- 255:baaaaaabaabbbbbabbaaaaaaaaabbaabaabaabbabbaaaaaaaaabbabbabbaabaa
-- </TILES>

-- <SPRITES>
-- 001:0000666000006f6000006644d666660005566600006666000004300000044300
-- 002:000000000000666000006f6000006644d6666600055666000066660000044000
-- 003:0000666000006f6000044660d666660005566600006666000004300000044300
-- 004:0000666000006f6000006644d666660005566600006666000033400000304400
-- 005:0000666000006f6000006644d666660005566600006666000003400000034400
-- 006:0000666000006f6000006644d666660005566600006666000004400000043300
-- 014:0000000000000000000000000000000000bbbcb000baacb000bacab0000bbb00
-- 015:0000000000000000000000000000000000000000000000000bacaac0bcbabbba
-- 016:0000000000000000000000000000000000000000000000000000000000006666
-- 017:000000000066500006666600066f660006666400066644440266000066330000
-- 018:0000000000000000000000000000000000000000000000440000000000006666
-- 019:00000000066500006666600066f6600046666000446600000666000062330000
-- 021:00000000000000000000000000000000066500006666600066f6600066664000
-- 032:0666666607666666007666660007755500000777000000030000000400000004
-- 033:6666600066656000566660006666600077660000020000000300000044330000
-- 034:0666666607666666007666660007755500000777000000030000000400000004
-- 035:6666600066656000566660006666600077660000020000000300000044330000
-- 036:0000000000006666066666660766666600766666000775550000077700000044
-- 037:0664444062660000663300006666600056656000666660007766000043300000
-- 048:0000000000000000000000000000000000000000000000000000000000006666
-- 049:000000000066500006666600066f660006666400066644440266000066330000
-- 050:0000000000000000000000000000000000000000000000000000000000006666
-- 051:000000000066500006666600066f660006666400066644440266000066330000
-- 052:0000000000000000000000000000000000000000000000000000000000006666
-- 053:000000000066500006666600066f660006666400066644440266000066330000
-- 064:0666666607666666007666660007755500000777000000320000003000000033
-- 065:6666600066656000566660006666000076600000030000000440000000440000
-- 066:0666666607666666007666660007755500000777000000320000033000000300
-- 067:6666600066656000566660006666000076600000300000004000000044000000
-- 068:0666666607666666007666660007755500000777000000030000004400000040
-- 069:6666600066656000566660006666000076600000200000003000000033000000
-- 080:0000000000000000000000000000000000000000000000000000000000000066
-- 081:0000000000000000000000000000000000000000000000000000000066660000
-- 083:00000000000000000000000000000000000000000000000000000000dd777777
-- 084:0000000000000000000000000000000000000000000000000000000077000000
-- 086:00000000000000000000000000000000000000000000000000000000dd777777
-- 087:0000000000000000000000000000000000000000000000000000000077000000
-- 089:00000000000000000000000000000000000000000000000000000000dd777777
-- 090:0000000000000000000000000000000000000000000000000000000077000000
-- 096:0066666600766666007766660007755500007776000000770000000300000004
-- 097:6666600066666663656666635665677266660000766000000200000044330000
-- 098:066500006666600066f660006666400006644440000000000000000000000000
-- 099:0dd7777700dd7777000ddddd0000777700000077000000070000000000000003
-- 100:7777000077777737777777377777773777770000777000003340000030440000
-- 101:77700000777700007f7700007774000077444400000000000000000000000000
-- 102:0dd7777700dd7777000ddddd0000777700000077000000070000000400000004
-- 103:7777000077777737777777377777773777770000777000004300000000330000
-- 104:77700000777700007f7700007774000077444400000000000000000000000000
-- 105:0dd7777700dd7777000ddddd0000777700000077000000070000000000000004
-- 106:7777000077777737777777377777773777770000777000004300000044300000
-- 107:77700000777700007f7700007774000077444400000000000000000000000000
-- 112:0000000000000000d66600000d6660000d66660000d6666000d6666600056666
-- 113:066500006666600066f6600d666640d706644447066427700266470066337700
-- 114:0000000000000000dd7000000d7700000d77700000d7770000d77777000d7777
-- 115:077700007777700077f7700d777740dd0774444007742dd003774d0077337d00
-- 116:0000000000000000dd7000000d7700000d77700000d7770000d77777000d7777
-- 117:077700007777700077f7700d777740dd0774444007742dd003774d0077337d00
-- 118:0000000000000000dd7000000d7700000d77700000d7770000d77777000d7777
-- 119:077700007777700077f7700d777740dd0774444007742dd003774d0077337d00
-- 128:0077556600777556000776660000776600000777000000030000000400000004
-- 129:6666600066656000666660006666000076600000020000000300000044330000
-- 130:0077dd77007777dd000777770000777700000077000000030000003000000033
-- 131:7777700077777000777700007777000077700000040000000440000000440000
-- 132:0077dd77007777dd000777770000777700000077000000030000033000000300
-- 133:7777700077777000777700007777000077700000400000004000000044000000
-- 134:0077dd77007777dd000777770000777700000077000000000000000400000004
-- 135:7777700077777000777700007777000077700000440000004300000003300000
-- 224:0000000000000000000000000000000000000000000000000000000000006666
-- 225:000000000066500006666600066f660006666400066644440266000066330000
-- 226:00000000000000000000000000000000000000000000000000000000d7666666
-- 227:000000000076600007666600076f660007666400076644440266000077330000
-- 228:0000000000000000000000000000000000000000000000000000000000009999
-- 229:000000000099a00009999900099f990009999400099944440199000099110000
-- 240:0666666607666666007666660007755500000777000000030000000400000004
-- 241:6666600066656000566660006666600077770000020000000300000044330000
-- 242:0d76565600d76665000ddee70000777600000077000000030000000400000004
-- 243:6766600066656000665660006666000076600000020000000300000044330000
-- 244:09999999089999990089999900088aaa00000888000000030000000400000004
-- 245:99999000999a9000a99990009999900088880000020000000300000044330000
-- </SPRITES>

-- <MAP>
-- 000:1e1e1e1e1e1e1e1e1e1e1e1e1e1e0e0e0e1e1e1e1e1e1e1e1e1e1e1e1e1e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:1f1fc0c0c0c0c0c0c0c0c0c0c01f1e1e1e0fc0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:1f1fc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:1f1fc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:1fc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:1fc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:1ec0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:1ec0c0d0e0e0e0e0e0e0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:1ed0e1e1e1e1e1e0e0e1e0e0f0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:1ee1e1e2e2d2e1e2e1e2e1e1e1f0c0c0c0c0c0c0c0d0e0e0e0e0e0e0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:1ec0f2c0c0c0c0c0c0c0c0d2e1e1e1f0e0e0e0e0e0e1e1e1e1e1e1e1e1f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:1ec0c0c0c0c0c0c0c0c0c0c0c0d2e1e1e1f2e1e1f2f2e2e2e2e2e2d2e1e1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:1ec0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0d2e2e2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:1ec0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:1ec0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:1ec0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- 014:77777777ffffffff77777777ffffffff
-- 015:0123432343210feddef0123432343210
-- </WAVES>

-- <SFX>
-- 000:ef00cf0faf118f116f325f442f551f550f662f654f637f52cf1bef0bff1cff3cff2dff2eff1fff1cff1cff1cff0cff0eff5fff50ff50ff40ff30ff00309000000000
-- 002:0e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e00307000000000
-- </SFX>

-- <PATTERNS>
-- 000:b22122000010100010000010000020000010000010000020000010000020000010000020000010000010000010000010000020000000000020000000600024000000100020000000b00022000000100020000000600024000000100020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:b22124000010100020000010000020000010000020000010000010000000000020000010000010000020000010000010000020000000000020000000600026000000100020000000b00024000000100020000000600026000000100020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:022120000020000020000010f00026d00026b00026600026000020800026000010100020f00026d00026b00026900026000000100020000000000000900026000000100020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:57f114000010000010000000800012000000000000000010500014000000000000000000800012000000000000000010000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:b221200000200000000000101000200000100000100000200000100000200000100000200000200000100000100000100000200000000000000000000000000000000000000000006c0022000000000000100000000000000000000000000000b00020000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600020000000000000000000100000000000000000000000
-- 005:b22122000010000000000010100020000010000020000010000010000000000020000010000020000020000010000010000020000000000000000000000000000000000000000000600024000000000000100000000000000000000000000000b00022000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600022000000000000000000100000000000000000000000
-- 006:022120000020000020000010000000000000000000000000b00028900028800028f00026000000100000400028000000100000f00028d00028a00028600028000000000020000000100000000000000000000000000000000000000000000000000000000000000000c00028900028800028f00026000000100000000000400028000000100000f00028d00028a00028600028000000600028000000600028000000000000000000100000000000000000000000000000000000000000000000
-- 007:000000000010000010000000000000000000000000000010000000000000000000000000000000000000000000000010000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </PATTERNS>

-- <TRACKS>
-- 000:180300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000230
-- 001:581700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </TRACKS>

-- <FLAGS>
-- 000:00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000001010100000000000000000000000000010101000000000000000000000000000
-- </FLAGS>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>


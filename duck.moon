-- title:  Duck
-- author: Nathan Jent
-- desc:   A game about a duck.
-- script: moon

t=0
objs={
 {
  x:96
  y:24
  elapsed:0
  flip:0
  states:{
   -- idle
   { w:2, h:2, frames:{ 272 } },
   -- walking
   {
    w:2
    h:2
    frames:{ 304, 306, 308, 304, 306, 308 }
   },
   -- ducking
   { w:3, h:2, frames:{ 336 } },
   -- quacking
   { w:2, h:2, frames:{ 368 } },
  }
 },
 {
  x:138
  y:48
  states:{
   {frames:{270}}
   {frames:{271}}
  }
 }
}

update = (t) ->
 p=objs[1]
 p.state = 1
 p.elapsed += 1
 if p.elapsed > 10
  p.elapsed = 0
  if p.tic and p.tic <= 6
   p.tic += 1
  else
   p.tic = 1
  p.holding = false

 if btn(4)
  p.state = 3
 if btn(5)
  p.state = 4
 if btnp(5)
  sfx(0,"G-4",15)
 if btn(6)
  p.holding = true
 if btn(0)
  p.y -= 1
  p.state = 2
 if btn(1)
  p.y += 1
  p.state = 2
 if btn(2)
  p.x -= 1
  p.state = 2
  p.flip = 1
 elseif btn(3)
  p.x += 1
  p.state = 2
  p.flip = 0

draw_obj=(obj)->
 tic = obj.tic or 1
 sdata = obj.states[obj.state or 1]
 frame = if tic > #sdata.frames
  sdata.frames[tic % #sdata.frames + 1]
 else
  sdata.frames[tic]

 spr(frame,obj.x,obj.y,0,1,obj.flip,0,sdata.w or 1,sdata.h or 1)

draw=(t)->
 cls(11)
 map(0,0,40,40,0,0)
 for obj in *objs
  draw_obj(obj)

music(0,0)
export TIC = ->
 update(t)
 draw(t)
 t += 1

-- <TILES>
-- 014:eeee0feeeee0de0eff0deeef0f0eeee0dee0ee0deeeef0deeeeef0deeeeeffee
-- 015:feffefffffffefefffefdeffeeededeefefedeffffefdfffffffefefffffefff
-- 239:bbaaaaabaaaabbbaabbbaaaabaaaaabbaaabbbaaabbaaaaabaaaaabbaabbbbaa
-- 255:baaaaaabaabbbbbabbaaaaaaaaabbaabaabaabbabbaaaaaaaaabbabbabbaabaa
-- </TILES>

-- <SPRITES>
-- 001:0000777000007f7000007744d77777000dd77700007777000004300000044300
-- 002:000000000000777000007f7000007744d77777000dd777000077770000044000
-- 003:0000777000007f7000044770d77777000dd77700007777000004300000044300
-- 004:0000777000007f7000007744d77777000dd77700007777000033400000304400
-- 005:0000777000007f7000007744d77777000dd77700007777000003400000034400
-- 006:0000777000007f7000007744d77777000dd77700007777000004400000043300
-- 014:0000000000000000000000000000000000bbbcb000baacb000bacab0000bbb00
-- 015:0000000000000000000000000000000000000000000000000bacaac0bcbabbba
-- 016:00000000000000000000000000000000000000000000000000000000d7666666
-- 017:000000000076600007666600076f660007666400076644440266000077330000
-- 018:00000000000000000000000000000000000000000000004400000000d7666666
-- 019:00000000076600007666600076f6600046666000446600000766000072330000
-- 021:000000000000000000000000000000000077600007666600076f660007666400
-- 032:0d76565600d76665000ddee70000e776000000e7000000040000000400000004
-- 033:6766600066656000665660006666000076600000030000000300000044330000
-- 034:0d76565600d76665000ddeee0000e77600000077000000040000000400000004
-- 035:6766600066656000665660006666000066600000030000000300000044330000
-- 036:00000000d67776670d67776600d67666000dddde0000ee77000000ee00000044
-- 037:0076444476233000677660006666600076667000667700007700000043300000
-- 048:00000000000000000000000000000000000000000000000000000000d7666666
-- 049:000000000076600007666600076f660007666400076644440266000077330000
-- 050:00000000000000000000000000000000000000000000000000000000d7666666
-- 051:000000000076600007666600076f660007666400076644440266000077330000
-- 052:00000000000000000000000000000000000000000000000000000000d7666666
-- 053:000000000076600007666600076f660007666400076644440266000077330000
-- 064:0d76565600d76665000ddee70000e776000000e7000000030000003000000033
-- 065:6766600066656000665660006666000076600000040000000440000000440000
-- 066:0d76565600d76665000ddee70000ee76000000e7000000030000033000000300
-- 067:6766600066656000665660006666000066600000400000004000000044000000
-- 068:0d76565600d76665000ddee60000e77700000076000000040000004400000040
-- 069:6766600066656000665660006566000066600000400000003000000033000000
-- 080:00000000000000000000000000000000000000000000000000000000d6777777
-- 081:0000000000000000000000000000000000000000000000000000000067000000
-- 083:00000000000000000000000000000000000000000000000000000000dd777777
-- 084:0000000000000000000000000000000000000000000000000000000077000000
-- 086:00000000000000000000000000000000000000000000000000000000dd777777
-- 087:0000000000000000000000000000000000000000000000000000000077000000
-- 089:00000000000000000000000000000000000000000000000000000000dd777777
-- 090:0000000000000000000000000000000000000000000000000000000077000000
-- 096:0d67776600d67666000ddddd0000ee77000000e70000000e0000000400000004
-- 097:6667000066666636766666366666772766670000777000000300000044330000
-- 098:76600000666600006f6600006664000076444400000000000000000000000000
-- 099:0dd7777700dd7777000ddddd0000777700000077000000070000000000000003
-- 100:7777000077777737777777377777773777770000777000003340000030440000
-- 101:77700000777700007f7700007774000077444400000000000000000000000000
-- 102:0dd7777700dd7777000ddddd0000777700000077000000070000000400000004
-- 103:7777000077777737777777377777773777770000777000004300000000330000
-- 104:77700000777700007f7700007774000077444400000000000000000000000000
-- 105:0dd7777700dd7777000ddddd0000777700000077000000070000000000000004
-- 106:7777000077777737777777377777773777770000777000004300000044300000
-- 107:77700000777700007f7700007774000077444400000000000000000000000000
-- 112:0000000000000000d67000000d7700000d67700000d7776000d67776000d6777
-- 113:077600007766600076f6600d766640dd0764444e07642ee002664e0067336e00
-- 114:0000000000000000dd7000000d7700000d77700000d7770000d77777000d7777
-- 115:077700007777700077f7700d777740dd0774444007742dd003774d0077337d00
-- 116:0000000000000000dd7000000d7700000d77700000d7770000d77777000d7777
-- 117:077700007777700077f7700d777740dd0774444007742dd003774d0077337d00
-- 118:0000000000000000dd7000000d7700000d77700000d7770000d77777000d7777
-- 119:077700007777700077f7700d777740dd0774444007742dd003774d0077337d00
-- 128:0077dd6700777eee000e77760000ee66000000e6000000040000000400000004
-- 129:7666600066667000666600006667000066700000030000000300000044330000
-- 130:0077dd77007777dd000777770000777700000077000000030000003000000033
-- 131:7777700077777000777700007777000077700000040000000440000000440000
-- 132:0077dd77007777dd000777770000777700000077000000030000033000000300
-- 133:7777700077777000777700007777000077700000400000004000000044000000
-- 134:0077dd77007777dd000777770000777700000077000000000000000400000004
-- 135:7777700077777000777700007777000077700000440000004300000003300000
-- </SPRITES>

-- <MAP>
-- 000:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- 014:77777777ffffffff77777777ffffffff
-- 015:0123432343210feddef0123432343210
-- </WAVES>

-- <SFX>
-- 000:ef00cf0faf118f116f325f442f551f550f662f654f637f52cf1bef0bff1cff3cff2dff2eff1fff1cff1cff1cff0cff0eff5fff50ff50ff40ff30ff00309000000000
-- 002:0e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e000e00307000000000
-- </SFX>

-- <PATTERNS>
-- 000:b22122000010100010000010000020000010000010000020000010000020000010000020000010000010000010000010000020000000000020000000600024000000100020000000b00022000000100020000000600024000000100020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:b22124000010100020000010000020000010000020000010000010000000000020000010000010000020000010000010000020000000000020000000600026000000100020000000b00024000000100020000000600026000000100020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:022120000020000020000010f00026d00026b00026600026000020800026000010100020f00026d00026b00026900026000000100020000000000000900026000000100020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:57f114000010000010000000800012000000000000000010500014000000000000000000800012000000000000000010000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:b221200000200000000000101000200000100000100000200000100000200000100000200000200000100000100000100000200000000000000000000000000000000000000000006c0022000000000000100000000000000000000000000000b00020000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600020000000000000000000100000000000000000000000
-- 005:b22122000010000000000010100020000010000020000010000010000000000020000010000020000020000010000010000020000000000000000000000000000000000000000000600024000000000000100000000000000000000000000000b00022000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600022000000000000000000100000000000000000000000
-- 006:022120000020000020000010000000000000000000000000b00028900028800028f00026000000100000400028000000100000f00028d00028a00028600028000000000020000000100000000000000000000000000000000000000000000000000000000000000000c00028900028800028f00026000000100000000000400028000000100000f00028d00028a00028600028000000600028000000600028000000000000000000100000000000000000000000000000000000000000000000
-- 007:000000000010000010000000000000000000000000000010000000000000000000000000000000000000000000000010000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </PATTERNS>

-- <TRACKS>
-- 000:180300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000230
-- 001:581700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </TRACKS>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>


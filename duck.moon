-- title:  Duck
-- author: Nathan Jent
-- desc:   short description
-- script: moon

t=0
p={
 x: 96
 y: 24
 tic: 1
 elapsed: 0
 state: 1
 flip: 0
 states: {
  {
   w: 2
   h: 2
   frames: { 272 }
  },
  {
   w: 2
   h: 2
   frames: { 304, 306, 308, 304, 306, 308 }
  },
  {
   w: 3
   h: 2
   frames: { 336 }
  },
  {
   w: 2
   h: 2
   frames: { 368 }
  }
 }
}

update = (t) ->
 p.state = 1
 p.elapsed += 1
 if p.elapsed > 10
  p.elapsed = 0
  p.tic += 1
  if p.tic > 6
   p.tic = 1

 if btn(4)
  p.state = 3
 if btn(5)
  p.state = 4
 if btnp(5)
  sfx(0,"G-4",15)
 if btn(0)
  p.y -= 1
  p.state = 2
 if btn(1)
  p.y += 1
  p.state = 2
 if btnp(2)
  p.flip = 1
 if btn(2)
  p.x -= 1
  p.state = 2
 if btnp(3)
  p.flip = 0
 if btn(3)
  p.x += 1
  p.state = 2

draw = (t) ->
 cls(11)
 map(0,0,40,40,0,0)
 print("t: #{t}",1,1)
 print("p.tic: #{p.tic}, p.x: #{p.x}, p.y: #{p.y}",1,8)

 sdata = p.states[p.state]
 frame = 1
 if p.tic > #sdata.frames
  frame = sdata.frames[#sdata.frames]
 else
  frame = sdata.frames[p.tic]

 print("frames: #{#sdata.frames}",1,16)
 print("frame: #{frame}",1,24)

 spr(frame,p.x,p.y,0,1,p.flip,0,sdata.w,sdata.h)

export TIC = ->
 update(t)
 draw(t)
 t += 1

-- <TILES>
-- 015:dfedfedefedeefe7efe7ffffffffdfededfefedefedeefe7efe7fffffdffedfd
-- 239:bbaaaaabaaaabbbaabbbaaaabaaaaabbaaabbbaaabbaaaaabaaaaabbaabbbbaa
-- 255:baaaaaabaabbbbbabbaaaaaaaaabbaabaabaabbabbaaaaaaaaabbabbabbaabaa
-- </TILES>

-- <SPRITES>
-- 001:0000eee00000ef700000e744d777e7000dd77700007777000003000000033000
-- 002:000000000000eee00000ef700000e744d777e7000dd777000077770000033000
-- 003:0000eee000007fe0000447e0d77777e00dd77700007777000003000000033000
-- 004:0000eee00000ef700000e744d777e7000dd77700007777000033400000304400
-- 005:0000eee00000ef700000e744d777e7000dd77700007777000003300000030400
-- 016:00000000000000000000000000000000000000000000000000000000dd777777
-- 017:000000000077700007777700077f770007777400077744440377000077330000
-- 018:00000000000000000000000000000000000000000000004400000000dd777777
-- 019:00000000077700007777700077f7700047777000447700000777000073330000
-- 032:0dd7777700dd7777000ddddd0000777700000077000000040000000400000004
-- 033:7777700077777000777770007777000077700000030000000300000044330000
-- 034:0dd7777700dd7777000ddddd0000777700000077000000040000000400000004
-- 035:7777700077777000777770007777000077700000030000000300000044330000
-- 048:00000000000000000000000000000000000000000000000000000000dd777777
-- 049:000000000077700007777700077f770007777400077744440377000077330000
-- 050:00000000000000000000000000000000000000000000000000000000dd777777
-- 051:000000000077700007777700077f770007777400077744440377000077330000
-- 052:00000000000000000000000000000000000000000000000000000000dd777777
-- 053:000000000077700007777700077f770007777400077744440377000077330000
-- 064:0dd7777700dd7777000ddddd0000777700000077000000030000003000000033
-- 065:7777700077777000777770007777000077700000040000000440000000440000
-- 066:0dd7777700dd7777000ddddd0000777700000077000000030000033000000300
-- 067:7777700077777000777770007777000077700000400000004000000044000000
-- 068:0dd7777700dd7777000ddddd0000777700000077000000040000004400000040
-- 069:7777700077777000777770007777000077700000400000003000000033000000
-- 080:00000000000000000000000000000000000000000000000000000000dd777777
-- 081:0000000000000000000000000000000000000000000000000000000077000000
-- 096:0dd7777700dd7777000ddddd0000777700000077000000070000000400000004
-- 097:7777000077777737777777377777773777770007777000000300000044330000
-- 098:77700000777700007f7700007774000077444400000000000000000000000000
-- 112:0000000000000000dd7000000d7700000d77700000d7770000d77777000d7777
-- 113:077700007777700077f7700d777740dd0774444007742dd003774d0077337d00
-- 128:0077dd77007777dd000777770000777700000077000000040000000400000004
-- 129:7777d0007777d000777700007777000077700000030000000300000044330000
-- 205:000000000000000000000000000000080000008800000889000088990000889a
-- 206:0000000000000000888888008999988899aa99999aaaaa99aa999aaaa9999999
-- 207:0000000000000000000000008000880088888880998899809999988099998800
-- 221:0000889a0000889900000889000000880000008800000889000888998888556a
-- 222:a9999999aa9999889aa99988956999985447999864579999a7799999aa999999
-- 223:8888800080000000800000008800000088000000888000009880000098880000
-- 234:00cc00cc00cc00cccc00cc00cc00cc0000cc00cc00cc00cccc00cc00cc00cc00
-- 235:00cc00cc00cc00cccc00cc00cc00cc0000cc00cc00cc00cccc00cc00cc00cc00
-- 236:0000088800008889000888990088899a008899aa08889a660889964408896444
-- 237:89966447999746479aa74477aaaa7779aaa99999779999994779999964799999
-- 238:a999999999999999999999999999999999999999999999999999999899999988
-- 239:9988000099880000998800009988000098800000888000008800000080000000
-- 250:00cc00cc00cc00cccc00cc00cc00cc0000cc00cc00cc00cccc00cc00cc00cc00
-- 251:00cc00cc00cc00cccc00cc00cc00cc0000cc00cc00cc00cccc00cc00cc00cc00
-- 252:08897444088967460889977408899a67088899aa088899aa0088899a00088899
-- 253:5479999946799999679999997a999999aa999999aaa99999aaaa9999aaaaaa99
-- 254:9999988899999888999998889999998899999998999999999999999999999999
-- 255:0000000000000000000000008000000088000000888000009888000099888000
-- </SPRITES>

-- <MAP>
-- 000:00f0f0f0f0f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:00f0f0f0f0f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:00f0f0f0f0f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:00f0f0f0f0f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:00f0f0f0f0f0f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:f0f0f0f0f0f0f00000000000ef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:00f0f0f0f0f0f0ef00000000efee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:0000000000000000000000ef0000ef000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:00000000000000000000000000eeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:000000000000000000000000ef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:000000000000000000000000ef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- 015:0123432343210feddef0123432343210
-- </WAVES>

-- <SFX>
-- 000:0f000f0f0f000f010f110f020f330f040f560f660f750f730f920fc00fee0fe80feb0fec0fdc0fcc0fac0f9c0f6c0f6e0f5f0f500f500f400f300f00b09000000000
-- </SFX>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>

